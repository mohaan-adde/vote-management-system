{% extends "base.html" %}

{% block title %}Voting Results{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
    
    {% set total_votes_cast = candidates | sum(attribute='votes') %}

    <div class="flex flex-col md:flex-row justify-between items-center mb-10 bg-white dark-mode:bg-gray-800 p-6 rounded-2xl shadow-sm border border-slate-100 dark-mode:border-gray-700">
        <div>
            <div class="flex items-center gap-3 mb-1">
                <h2 class="text-2xl font-bold text-slate-900 dark-mode:text-white">Live Results</h2>
                <span class="relative flex h-3 w-3">
                  <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span>
                  <span class="relative inline-flex rounded-full h-3 w-3 bg-emerald-500"></span>
                </span>
            </div>
            <p class="text-slate-500 dark-mode:text-slate-400 text-sm">Real-time vote tracking dashboard</p>
        </div>
        <div class="mt-4 md:mt-0 text-right">
            <div class="text-xs font-semibold uppercase tracking-wider text-slate-400">Total Votes Cast</div>
            <div class="text-2xl font-mono font-bold text-indigo-600 dark-mode:text-indigo-400">
                {{ total_votes_cast }}
            </div>
        </div>
    </div>

    <div class="space-y-5">
        {% for c in candidates %}
        {% set rank = loop.index %}
        
        {# Xisaabinta Boqolleyda Dynamic ah #}
        {% if total_votes_cast > 0 %}
            {% set percentage = ((c.votes / total_votes_cast) * 100) %}
        {% else %}
            {% set percentage = 0 %}
        {% endif %}
        
        <div class="group relative bg-white dark-mode:bg-gray-800 rounded-xl p-5 shadow-sm border border-slate-100 dark-mode:border-gray-700 transition-all duration-300 hover:shadow-lg hover:-translate-y-1 hover:border-indigo-100 dark-mode:hover:border-gray-600 mt-6">
            
            {% if rank == 1 %}
                <div class="absolute inset-y-0 left-0 w-1.5 bg-yellow-400 rounded-l-xl shadow-[0_0_15px_rgba(250,204,21,0.5)]"></div>
            {% elif rank == 2 %}
                <div class="absolute inset-y-0 left-0 w-1.5 bg-slate-300 rounded-l-xl"></div>
            {% elif rank == 3 %}
                <div class="absolute inset-y-0 left-0 w-1.5 bg-amber-600 rounded-l-xl"></div>
            {% endif %}

            <div class="flex flex-col md:flex-row items-center gap-6">
                
                <div class="flex items-center w-full md:w-auto flex-shrink-0">
                    
                    <div class="w-12 flex-shrink-0 text-center mr-4">
                        {% if rank == 1 %}
                            <div class="h-10 w-10 mx-auto bg-yellow-100 text-yellow-700 rounded-full flex items-center justify-center font-bold text-lg ring-4 ring-yellow-50 shadow-md">1</div>
                        {% elif rank == 2 %}
                            <div class="h-9 w-9 mx-auto bg-slate-100 text-slate-700 rounded-full flex items-center justify-center font-bold text-lg">2</div>
                        {% elif rank == 3 %}
                            <div class="h-9 w-9 mx-auto bg-orange-50 text-amber-700 rounded-full flex items-center justify-center font-bold text-lg">3</div>
                        {% else %}
                            <div class="text-slate-400 font-semibold text-lg">#{{ rank }}</div>
                        {% endif %}
                    </div>

                    <div class="relative">
                        {% if rank == 1 %}
                        <div class="absolute -top-7 left-1/2 transform -translate-x-1/2 z-10 animate-bounce-slow">
                             <svg class="w-8 h-8 text-yellow-400 drop-shadow-md filter" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M5 16L3 5l5.5 5L12 4l3.5 6L21 5l-2 11H5zm14 3c0 .6-.4 1-1 1H6c-.6 0-1-.4-1-1v-1h14v1z"></path>
                             </svg>
                        </div>
                        {% endif %}

                        {% set photo_url = c.photo or ('https://ui-avatars.com/api/?name=' ~ c.name ~ '&background=random&color=fff') %}
                        
                        <img src="{{ photo_url }}" alt="{{ c.name }}" 
                             class="w-16 h-16 rounded-full object-cover shadow-md ring-4 
                             {% if rank == 1 %} ring-yellow-400 ring-offset-2 {% else %} ring-white dark-mode:ring-gray-700 {% endif %}">
                    </div>
                </div>

                <div class="flex-grow text-center md:text-left w-full pt-2 md:pt-0">
                    <h3 class="text-xl font-bold text-slate-900 dark-mode:text-white group-hover:text-indigo-600 transition-colors">
                        {{ c.name }}
                        {% if rank == 1 %}
                        <span class="ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gradient-to-r from-yellow-200 to-yellow-500 text-yellow-900 shadow-sm">
                            üèÜ Winner
                        </span>
                        {% endif %}
                    </h3>
                    <p class="text-sm text-slate-500 dark-mode:text-slate-400 italic">"{{ c.motto }}"</p>
                </div>

                <div class="w-full md:w-1/3 flex flex-col justify-center">
                    <div class="flex justify-between items-end mb-2">
                        <span class="text-2xl font-bold text-slate-900 dark-mode:text-white">{{ c.votes }} <span class="text-sm font-normal text-slate-400">votes</span></span>
                        <span class="text-sm font-semibold text-indigo-600 dark-mode:text-indigo-400">{{ percentage | round(1) }}%</span>
                    </div>
                    
                    <div class="w-full bg-slate-100 dark-mode:bg-gray-700 rounded-full h-3 overflow-hidden shadow-inner">
                        {% set bar_color = 'bg-indigo-600' %}
                        {% if rank == 1 %}{% set bar_color = 'bg-gradient-to-r from-yellow-400 to-yellow-600' %}
                        {% elif rank == 2 %}{% set bar_color = 'bg-slate-400' %}
                        {% elif rank == 3 %}{% set bar_color = 'bg-amber-600' %}
                        {% endif %}
                        
                        <div class="h-full rounded-full transition-all duration-1000 ease-out {{ bar_color }} relative" 
                             style="width: {{ percentage }}%;">
                                <div class="absolute top-0 left-0 bottom-0 right-0 bg-white opacity-20" style="background: linear-gradient(to bottom, rgba(255,255,255,0.4), rgba(255,255,255,0));"></div>
                             </div>
                    </div>
                </div>

            </div>
        </div>
        {% endfor %}
    </div>

    <div class="mt-8 flex justify-center items-center gap-2 text-xs text-slate-400">
        <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
        <p>Percentage represents the share of total votes cast so far.</p>
    </div>

</div>

<style>
  @keyframes bounce-slow {
    0%, 100% { transform: translate(-50%, -5%); }
    50% { transform: translate(-50%, 5%); }
  }
  .animate-bounce-slow {
    animation: bounce-slow 2s infinite;
  }
</style>
{% endblock %}